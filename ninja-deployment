#!/bin/bash
# Author: bibz0r
#
#       This script checks for potential CVE-2022-21449 existence
#       Run without arguments to check recursively in "/"
#


cleanup () {
        rm -rf /tmp/jfrog-CVE-2022-21449/
}

# let's check if python3 is installed
if [ -x "$(command -v python3)" ]; then
        pythonInstalled=true
fi

# let's check if wget is installed
if [ -x "$(command -v wget)" ]; then
        wgetInstalled=true
fi



# if python3 AND wget is installed we can continue
if [ "$pythonInstalled" -a "$wgetInstalled" ]; then
        echo "Python3 and wget installed"

        # create directory if not exists
        if [ ! -d /tmp/jfrog-CVE-2022-21449/ ]; then
                mkdir -p /tmp/jfrog-CVE-2022-21449;
                cd /tmp/jfrog-CVE-2022-21449
                wget https://raw.githubusercontent.com/bibz0r/jfrog-CVE-2022-21449/main/cve_2022_21449.py

                if test -f cve_2022_21449.py; then
                        output="$(python3 cve_2022_21449.py / -quiet)"
                        echo $output
                        cleanup
                else
                        echo "Konnte Skript zur überprüfung nicht herunterladen ODER die Datei existiert nicht!"
                fi


        fi
else
  "FEHLER: Python3 und wget müssen installiert sein! "
fi
